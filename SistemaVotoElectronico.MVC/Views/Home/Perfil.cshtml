@model dynamic
@{
    ViewData["Title"] = "Mi Perfil";
}

<div class="container py-5">
    @if (TempData["Mensaje"] != null)
    {
        <div class="alert alert-@TempData["Tipo"] alert-dismissible fade show rounded-4 border-0 shadow mb-4" role="alert">
            <div class="d-flex align-items-center">
                <i class="fa-solid fa-circle-info me-3 fs-4"></i>
                <span class="fw-medium">@TempData["Mensaje"]</span>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <div class="row g-4">
        <div class="col-lg-4">
            <div class="profile-card text-center pb-4">
                <div class="profile-header-bg"></div>

                <div class="px-4">
                    <div class="profile-avatar-wrapper">
                        @if (!string.IsNullOrEmpty(Model.Foto))
                        {
                            <img src="@Model.Foto" class="profile-img" alt="Foto de perfil" />
                        }
                        else
                        {
                            <div class="profile-img-placeholder">
                                <i class="fa-regular fa-user"></i>
                            </div>
                        }

                        <form asp-controller="Home" asp-action="UpdateProfilePhoto" enctype="multipart/form-data" method="post">
                            <label for="fileUpload" class="btn-camera" title="Subir nueva foto">
                                <i class="fa-solid fa-camera"></i>
                            </label>
                            <input type="file" id="fileUpload" name="fotoUpload" accept="image/*" class="d-none" onchange="this.form.submit()" />
                        </form>
                    </div>

                    <h3 class="fw-bold mb-1">@Model.Nombre</h3>

                    <div class="mb-3">
                        <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2 rounded-pill fw-bold">
                            @Model.Rol.ToUpper()
                        </span>
                    </div>
                    <p class="text-muted small mb-4"><i class="fa-regular fa-envelope me-2"></i>@Model.Correo</p>

                    <div class="stats-box mb-3">
                        <div class="row text-center">
                            <div class="col-6 border-end" style="border-color: var(--border-color) !important;">
                                <div class="small text-uppercase text-muted fw-bold">@Model.Stat1Label</div>
                                <div class="fs-4 fw-bold">@Model.Stat1Value</div>
                            </div>
                            <div class="col-6">
                                <div class="small text-uppercase text-muted fw-bold">@Model.Stat2Label</div>
                                <div class="fs-4 fw-bold">@Model.Stat2Value</div>
                            </div>
                        </div>
                    </div>

                    <a href="@Url.Action("Logout", "Account")" class="btn btn-outline-danger w-100 rounded-pill fw-bold py-2 mt-2">
                        <i class="fa-solid fa-power-off me-2"></i> Cerrar Sesión
                    </a>
                </div>
            </div>
        </div>

        <div class="col-lg-8">
            <h4 class="fw-bold mb-4 ms-2">Panel de Control</h4>

            @if (Model.Rol == "Administrador")
            {
                <div class="row g-3">
                    <div class="col-md-6">
                        <a href="@Url.Action("Index", "Elecciones")" class="dashboard-card">
                            <div class="dashboard-icon-box d-icon-primary"><i class="fa-solid fa-calendar-days"></i></div>
                            <h5 class="fw-bold">Elecciones</h5>
                            <p class="text-muted small mb-0">Gestionar procesos electorales activos y cerrados.</p>
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="@Url.Action("Index", "Mesas")" class="dashboard-card">
                            <div class="dashboard-icon-box d-icon-primary"><i class="fa-solid fa-person-booth"></i></div>
                            <h5 class="fw-bold">Mesas</h5>
                            <p class="text-muted small mb-0">Administrar puntos de votación.</p>
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="@Url.Action("Index", "PadronElectorales")" class="dashboard-card">
                            <div class="dashboard-icon-box d-icon-success"><i class="fa-solid fa-users-viewfinder"></i></div>
                            <h5 class="fw-bold">Padrón Electoral</h5>
                            <p class="text-muted small mb-0">Base de datos de ciudadanos habilitados.</p>
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="@Url.Action("Index", "Votos")" class="dashboard-card">
                            <div class="dashboard-icon-box d-icon-warning"><i class="fa-solid fa-chart-simple"></i></div>
                            <h5 class="fw-bold">Resultados</h5>
                            <p class="text-muted small mb-0">Auditoría de votos y gráficas en tiempo real.</p>
                        </a>
                    </div>
                </div>
            }

            else if (Model.Rol == "Candidato")
            {
                <div class="dashboard-card mb-4 border-start border-4 border-warning">
                    <div class="d-flex flex-column flex-md-row align-items-center">
                        <div class="dashboard-icon-box d-icon-warning mb-3 mb-md-0 me-md-4" style="width: 80px; height: 80px; font-size: 2.5rem;">
                            <i class="fa-solid fa-bullhorn"></i>
                        </div>
                        <div class="text-center text-md-start flex-grow-1">
                            <h4 class="fw-bold">Mi Campaña</h4>
                            <p class="text-muted">Gestione la información visible para los votantes.</p>
                        </div>
                        @if (Model.ListaId != 0)
                        {
                            <a href="@Url.Action("Edit", "ListaElectorales", new { id = Model.ListaId })" class="btn btn-warning fw-bold px-4 py-2 rounded-pill shadow-sm">
                                Editar Lista
                            </a>
                        }
                        else
                        {
                            <span class="badge bg-secondary">Sin lista asignada</span>
                        }
                    </div>
                </div>
            }

            else if (Model.Rol == "JefeDeMesa")
            {
                <div class="dashboard-card bg-primary bg-opacity-10 border-0 mb-4">
                    <div class="text-center py-4">
                        <div class="dashboard-icon-box d-icon-primary mx-auto mb-3" style="width: 90px; height: 90px; font-size: 3rem;">
                            <i class="fa-solid fa-user-shield"></i>
                        </div>
                        <h3 class="fw-bold text-primary">Operaciones de Mesa</h3>
                        <p class="text-muted mb-4" style="max-width: 500px; margin: 0 auto;">Utilice esta herramienta para validar la identidad de los votantes y habilitar su acceso a la cabina de votación.</p>

                        <a href="@Url.Action("Autorizar", "PadronElectorales")" class="btn btn-primary btn-lg rounded-pill px-5 py-3 fw-bold shadow">
                            <i class="fa-solid fa-magnifying-glass me-2"></i> Buscar Votante
                        </a>
                    </div>
                </div>
            }

            else if (Model.Rol == "Votante")
            {
                <div class="dashboard-card">
                    <h5 class="fw-bold mb-4 border-bottom pb-3">Historial de Participación</h5>

                    @if (Model.Items != null && Model.Items.Count > 0)
                    {
                        <div class="timeline-container">
                            @foreach (var item in Model.Items)
                            {
                                <div class="timeline-item">
                                    <div class="timeline-dot @(item.HaVotado ? "active" : "")"></div>
                                    <h6 class="fw-bold mb-1">@item.Titulo</h6>
                                    <p class="text-muted small mb-2">Estado: @(item.HaVotado ? "Voto Registrado" : "Pendiente")</p>

                                    @if (item.HaVotado)
                                    {
                                        <span class="badge bg-success bg-opacity-10 text-success rounded-pill px-3">
                                            <i class="fa-solid fa-check me-1"></i> Completado
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-warning bg-opacity-10 text-warning rounded-pill px-3">
                                            <i class="fa-regular fa-clock me-1"></i> Pendiente
                                        </span>
                                    }
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-5 text-muted opacity-50">
                            <i class="fa-regular fa-folder-open display-4 mb-3"></i>
                            <p>No hay registros en tu historial.</p>
                        </div>
                    }
                </div>
            }
        </div>
    </div>
</div>